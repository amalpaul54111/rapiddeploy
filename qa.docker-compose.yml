services:
  backend:
    user: "${UID:-0}:${GID:-0}"
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites

  frontend:
    # environment:
    #     FRAPPE_SITE_NAME_HEADER: ${SITE}
    volumes:
      - ./nginx.conf:/etc/nginx/templates/default.conf.template

  queue-short:
    user: "${UID:-0}:${GID:-0}"
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites

  queue-default:
    user: "${UID:-0}:${GID:-0}"
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites

  queue-long:
    user: "${UID:-0}:${GID:-0}"
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites

  scheduler:
    user: "${UID:-0}:${GID:-0}"
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites
  
  migrate:
    restart: on-failure
    image: ${WORKER_IMAGE}
    user: "${UID:-0}:${GID:-0}"
    command: bash -c "bench set-config -g developer_mode 1 && bench --site ${SITE} migrate"
    environment:
    - ADMIN_PASSWORD=AdminPassword@123
    volumes:
      - ./sites:/home/frappe/frappe-bench/sites
